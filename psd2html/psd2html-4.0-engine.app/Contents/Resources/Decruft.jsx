// jsilver PSD compiler// for use with psd2html#target photoshop// in case we double clicked the file//app.bringToFront();document_name = app.activeDocument.name.split('.')[0];function log(mesg) {    $.write(mesg + "\n");   }function processLayer(theLayer) { layer_name = theLayer.name; layer_name += " "; layer_name += document_name.replace("-psd2html", ""); layer_name = layer_name.replace("copy", "");   // keep text text if(theLayer.kind != LayerKind.TEXT) {    convertToSmartObject();    rasterizeLayer(); }  avoidImageCollisions();}function avoidImageCollisions() {     try {     var idsetd = charIDToTypeID( "setd" );        var desc4 = new ActionDescriptor();        var idnull = charIDToTypeID( "null" );            var ref3 = new ActionReference();            var idLyr = charIDToTypeID( "Lyr " );            var idOrdn = charIDToTypeID( "Ordn" );            var idTrgt = charIDToTypeID( "Trgt" );            ref3.putEnumerated( idLyr, idOrdn, idTrgt );        desc4.putReference( idnull, ref3 );        var idT = charIDToTypeID( "T   " );            var desc5 = new ActionDescriptor();            var idNm = charIDToTypeID( "Nm  " );            desc5.putString( idNm, layer_name);        var idLyr = charIDToTypeID( "Lyr " );        desc4.putObject( idT, idLyr, desc5 );    executeAction( idsetd, desc4, DialogModes.NO );     } catch(e) {            } }function processLayers(theParent) {   for (var m = theParent.layers.length - 1; m >= 0;m--) {       var theLayer = theParent.layers[m];        app.activeDocument.activeLayer = theLayer;                if (theLayer.typename == "ArtLayer") {            processLayer(theLayer);        } else {            processLayers(theLayer);          }     };}// fastfunction deleteAllHiddenLayers() {    try {    var idDlt = charIDToTypeID( "Dlt " );        var desc24 = new ActionDescriptor();        var idnull = charIDToTypeID( "null" );            var ref23 = new ActionReference();            var idLyr = charIDToTypeID( "Lyr " );            var idOrdn = charIDToTypeID( "Ordn" );            var idhidden = stringIDToTypeID( "hidden" );            ref23.putEnumerated( idLyr, idOrdn, idhidden );        desc24.putReference( idnull, ref23 );    executeAction( idDlt, desc24, DialogModes.NO );    } catch(e) {            } } function convertToSmartObject() {    try {    var idnewPlacedLayer = stringIDToTypeID( "newPlacedLayer" );    executeAction( idnewPlacedLayer, undefined, DialogModes.NO );    } catch(e) {            }}// useful if your artist uses a lot of the same names for layers between designs, but there are differences in the actual lookfunction rasterizeLayer() {    var idrasterizeLayer = stringIDToTypeID( "rasterizeLayer" );        var desc21 = new ActionDescriptor();        var idnull = charIDToTypeID( "null" );            var ref20 = new ActionReference();            var idLyr = charIDToTypeID( "Lyr " );            var idOrdn = charIDToTypeID( "Ordn" );            var idTrgt = charIDToTypeID( "Trgt" );            ref20.putEnumerated( idLyr, idOrdn, idTrgt );        desc21.putReference( idnull, ref20 );    executeAction( idrasterizeLayer, desc21, DialogModes.NO );}function savePsd() {    var idsave = charIDToTypeID( "save" );    executeAction( idsave, undefined, DialogModes.NO );}function quitPhotoshop() {   var idsave = charIDToTypeID( "quit" );   executeAction( idsave, undefined, DialogModes.NO );  }function compilePsd (theParent) {     deleteAllHiddenLayers();     processLayers(theParent);        savePsd();        quitPhotoshop();     };doc = app.activeDocument;compilePsd(doc);